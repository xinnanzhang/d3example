topomap.TopoMap=function(a){this._items=new topomap.NodeList();this._lines=new topomap.NodeList();this._svgMap=new topomap.BaseMap(a,this);this._maxX=2700;this._maxY=2200;this._compWidth=1000;this._compHeight=800;this._overviewWidth=200;this._overviewHeight=200;this._topy=90;this._leftx=230;this._nodeDisplayType=1;this._linkDisplayType=1;this._layer=null;this.svg=null;this._nodetooltipdesc="";this._grouptooltipdesc="";this._linktooltipdesc="";this._menudesc="";this._submenudesc="";this._groupmenudesc="";this._linkmenudesc="";this._nodemenudesc="";this._tooltipdata=[];this._refreshdata=[];this._layoutdata=[];this._alertdata=[];this._prealertdata=[];this._newlinedata=null;this._newgroup=null;this._newdevice=null;this._plinedata=null;this._pnodedata=null;this._showpc=0;this._pcmenu="";this._locatenode=null;this._subchartdata=[];this._Timer1=null;this._UpdateCount=0;this._UpdateNode=null;this._UpdateTag=0;this._toposet=[];this._linkset=null;this._delnode=0;this._deline=0;this._lineshowhide="";this._hidelines=[]};topomap.TopoMap.prototype={addItem:function(a){this._items.add(a)},removeItem:function(a){this._items.remove(a)},setCleardata:function(a){this._items=new topomap.NodeList();this._lines=new topomap.NodeList()},setRender:function(a){this.render(this._BaseMap)},addLine:function(a){this._lines.add(a)},removeLine:function(a){this._lines.remove(a)},destroy:function(){this._BaseMap.destroy()},initialize:function(a){this._BaseMap=a;this._layer=a.getLayer("layer");this.svg=a._svg},setDelnode:function(a){this._delnode=a;var b=this;if(a==1){b.updatenodesdata(0);b.updatelinksdata(1);b.deletelinks();b.deletenodes()}else{if(a==2){b.updatelinksdata(2);b.updatenodesdata(1);b.deletelinks();b.deletenodes()}}},getDelnode:function(){return this._delnode},setDeline:function(a){var b=this;if(a==1){b.updatelinksdata(0);b.deletelinks()}},getDeline:function(){return this._deline},setHidelines:function(a){this._hidelines=a},getHidelines:function(){return this._hidelines},setLineshowhide:function(a){this._lineshowhide=a},getLineshowhide:function(){return this._lineshowhide},setTopy:function(a){this._topy=a},getTopy:function(){return this._topy},setPcmenu:function(a){this._pcmenu=a},getPcmenu:function(){return this._pcmenu},setLocatenode:function(a){this._locatenode=a;this.LocateNode(a)},getLocatenode:function(){return this._locatenode},setLeftx:function(a){this._leftx=a},getLeftx:function(){return this._leftx},setNodeDisplayType:function(a){this._nodeDisplayType=a},getNodeDisplayType:function(){return this._nodeDisplayType},setShowpc:function(a){this._showpc=a},getShowpc:function(){return this._showpc},setLinkDisplayType:function(a){this._linkDisplayType=a},getLinkDisplayType:function(){return this._linkDisplayType},setMaxX:function(a){if(a>this._maxX){this._maxX=a}},getMaxX:function(){return this._maxX},setMaxY:function(a){if(a>this._maxY){this._maxY=a}},getMaxY:function(){return this._maxY},setCompWidth:function(a){this._compWidth=a},getCompWidth:function(){return this._compWidth},setCompHeight:function(a){this._compHeight=a},getCompHeight:function(){return this._compHeight},setOverviewWidth:function(a){this._overviewWidth=a},getOverviewWidth:function(){return this._overviewWidth},setOverviewHeight:function(a){this._overviewHeight=a},getOverviewHeight:function(){return this._overviewHeight},setNodetooltipdesc:function(a){this._nodetooltipdesc=a},getNodetooltipdesc:function(){return this._nodetooltipdesc},setGrouptooltipdesc:function(a){this._grouptooltipdesc=a},getGrouptooltipdesc:function(){return this._grouptooltipdesc},setLinktooltipdesc:function(a){this._linktooltipdesc=a},getLinktooltipdesc:function(){return this._linktooltipdesc},setMenudesc:function(a){this._menudesc=a},getSubmenudesc:function(){return this._submenudesc},setSubmenudesc:function(a){this._submenudesc=a},getGroupmenudesc:function(){return this._groupmenudesc},setGroupmenudesc:function(a){this._groupmenudesc=a},getMenudesc:function(){return this._menudesc},setNodemenudesc:function(a){this._nodemenudesc=a},getNodemenudesc:function(){return this._nodemenudesc},setLinkmenudesc:function(a){this._linkmenudesc=a},getLinkmenudesc:function(){return this._linkmenudesc},setNewdevice:function(c){var b=this;this._newdevice=c;var a={};var d=c.nid;a.sid=d;a.nx=c.nx-16;a.ny=c.ny-16;a.otype=c.type;a.localip=c.ip;a.mac=c.mac;a.name=c.name;a.customname=c.customname;a.factory=c.manufact;a.model=c.model;nodelinedata[d]=a;nodedata.push(a);b.createnodes();b.updateoverviewnode()},getNewdevice:function(){return this._newdevice},setNewlinedata:function(a){this._newlinedata=a;this.refreshnewline()},getNewlinedata:function(){return this._newlinedata},setPlinedata:function(a){this._plinedata=a;this.refreshpline()},getPlinedata:function(){return this._plinedata},setPnodedata:function(a){this._pnodedata=a;this.refreshpnode()},getPnodedata:function(){return this._pnodedata},setNewgroup:function(c){this._newgroup=c;var b={};var d=c.gid;b.sid=c.gid;b.nx=c.nx-16;b.ny=c.ny-16;b.otype=100;b.localip=c.name;b.mac=c.createtime;b.name=c.name;b.customname=c.name;b.factory=c.iplist;b.model=c.name;b.state=0;nodelinedata[d]=b;nodedata.push(b);newgroupnode=b;this.updatesubchart();var a=this.getAlertdata();a.map(function(f,e){if(nodelinedata[f.nid]!==undefined){nodelinedata[f.nid].state=f.state}if(c.iplist.indexOf(f.ip)>=0){if(nodelinedata[c.gid]!==undefined){if(nodelinedata[c.gid].state!=1){nodelinedata[c.gid].state=f.state}}}});nodealertimg.attr("xlink:href",function(e){switch(e.state){case 0:return"";case 1:return"rwt-resources/topomap/error.png";case 2:return"rwt-resources/topomap/warning.png";default:return""}})},getNewgroup:function(){return this._newgroup},setTooltipdata:function(a){this._tooltipdata=a},setRefreshdata:function(a){this._refreshdata=a;this.refreshData(a)},setLayoutdata:function(a){this._layoutdata=a;this.toporedrawlayout(a)},setAlertdata:function(a){var b=this;b._prealertdata=b.getAlertdata();this._alertdata=a;this.refreshalertdata(a,b._prealertdata)},getAlertdata:function(){return this._alertdata},setToposet:function(a){this._toposet=a;linetextdata.map(function(c,b){if(c.selfalert!=1){c.error=a.error;c.warn=a.warn;c.pktserror=a.pktserror;c.pktswarn=a.pktswarn;c.broadcasterror=a.broadcasterror;c.broadcastwarn=a.broadcastwarn;c.bwusagerror=a.bwusagerror;c.bwusagewarn=a.bwusagewarn}})},setLinkset:function(a){this._linkset=a;lineidata[a.lid].error=a.error;lineidata[a.lid].warn=a.warn;lineidata[a.lid].pktserror=a.pktserror;lineidata[a.lid].pktswarn=a.pktswarn;lineidata[a.lid].broadcasterror=a.broadcasterror;lineidata[a.lid].broadcastwarn=a.broadcastwarn;lineidata[a.lid].bwusagerror=a.bwusagerror;lineidata[a.lid].bwusagewarn=a.bwusagewarn;lineidata[a.lid].selfalert=1},setSubchartdata:function(b){this._subchartdata=b;this.udatetopochart(b);var a=this.getAlertdata();a.map(function(d,c){if(nodelinedata[d.nid]!==undefined){nodelinedata[d.nid].state=d.state}});nodealertimg.attr("xlink:href",function(c){switch(c.state){case 0:return"";case 1:return"rwt-resources/topomap/error.png";case 2:return"rwt-resources/topomap/warning.png";default:return""}})},render:function(c){var m=document.getElementsByTagName("HEAD").item(0);var b=document.createElement("link");b.href="rwt-resources/topo.css";b.rel="stylesheet";b.type="text/css";m.appendChild(b);that1=this;overvieww=this.getOverviewWidth();overviewh=this.getOverviewHeight();maindiv=document.getElementById("maindiv");nodeshowtype=this.getNodeDisplayType();linkshowtype=this.getLinkDisplayType();nodetips=this.getNodetooltipdesc();grouptips=this.getGrouptooltipdesc();linktips=this.getLinktooltipdesc();nodeclick=false;shiftKey=null;ctlKey=null;mousedownnode=null,mouseupnode=null;dragup=false;d3.select("body").on("keydown.brush",e).on("keyup.brush",a).each(function(){this.focus()});function e(){shiftKey=d3.event.shiftKey;ctlKey=d3.event.ctrlKey}function a(){shiftKey=null;ctlKey=null}d3.select("#maindiv").on("contextmenu",this.contextmainmenu);function d(){mousedownnode=null;mouseupnode=null}nodesselected=true;d3.select("#maindiv").on("mousedown",function(){d3.select("#Mainmenu").style("display","none");d3.select("#mymenu").style("display","none");d3.select("#linkmenu").style("display","none");d3.select("#submenu").style("display","none");d3.select("#groupmenu").style("display","none");nodesselected=false;var u=maindiv.scrollLeft;var t=maindiv.scrollTop;localx=d3.mouse(this)[0]+u+16;localy=d3.mouse(this)[1]+t+16;select_rect.data([{x:localx,y:localy,w:0,h:0}]);select_rect.attr("x",function(v){return v.x}).attr("y",function(v){return v.y}).attr("width",function(v){return v.w}).attr("height",function(v){return v.h})}).on("mouseup",function(){if(nodeclick){nodeclick=false}else{d3.selectAll(".selected").classed("selected",function(C){C.selected=false;return false})}if(mousedownnode){drag_line.classed("hidden",true).style("marker-end","")}if(!mousedownnode){if(!nodesselected){var z=maindiv.scrollLeft;var v=maindiv.scrollTop;extentx=d3.mouse(this)[0]+z+16;extenty=d3.mouse(this)[1]+v+16;var u,B,t,A;if(localx>extentx){u=extentx;B=localx}else{u=localx;B=extentx}if(localy>extenty){t=extenty;A=localy}else{t=localy;A=extenty}node.classed("selected",function(C){if(C.nx>u&&C.nx<B&&C.ny>t&&C.ny<A){C.selected=true;return true}});nodesselected=true}}d();select_rect.attr("width",0).attr("height",0)}).on("mousemove",function(){var B=maindiv.scrollLeft;var A=maindiv.scrollTop;var z=d3.mouse(this)[0]+B;var v=d3.mouse(this)[1]+A;if(!mousedownnode){if(!nodesselected){var t=z-localx+16;if(t<0){t=0}var u=v-localy+16;if(u<0){u=0}select_rect.data([{x:0,y:0,w:t,h:u}]);select_rect.attr("width",function(C){return C.w}).attr("height",function(C){return C.h})}return}drag_line.attr("d","M"+mousedownnode.nx+","+mousedownnode.ny+"L"+z+","+v)});this._initMainMenu();this._initMenu();this._initSubMenu();this._initGroupMenu();this._initLinkMenu();drag_line=this._layer.append("svg:path").attr("class","link dragline hidden").attr("d","M0,0L0,0");var f=this._layer.append("g").attr("class","brush").data([{x:0,y:0,w:0,h:0}]);select_rect=f.append("svg:rect").attr("class","selectrect").attr("fill-opacity",0).attr("stroke","red").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.w}).attr("height",function(t){return t.h});link=this._layer.append("g").attr("class","link").selectAll("line");link1=this._layer.append("g").attr("class","link1").selectAll("line");linktip=this._layer.append("g").attr("class","linktip").selectAll("line");linktext=this._layer.append("g").attr("class","text2link").selectAll("text");linkintext=this._layer.append("g").attr("class","text2linkin").selectAll("text");linkouttext=this._layer.append("g").attr("class","text2linkout").selectAll("text");var r=this._layer.append("g").attr("class","nodelist");nodedata=new Array();nodelinedata=new Array();var s={};for(var l=0;l<this._items.length;l++){var q=this._items[l];var o=q.getSvid();s.sid=o;s.nx=q.getNx()-16;s.ny=q.getNy()-16;s.otype=q.getSvgtype();s.localip=q.getLocalip();s.mac=q.getMac();s.name=q.getName();s.customname=q.getCustomname();s.factory=q.getFactory();s.model=q.getModel();s.state=0;nodelinedata[o]=s;nodedata.push(s);s={}}linetextdata=new Array();lineidata=new Array();var k={};for(var l=0;l<this._lines.length;l++){var q=this._lines[l];var p=q.getLsource();var g=q.getLtarget();var n=q.getLid();k.source=nodelinedata[p];k.target=nodelinedata[g];k.lid=n;k.sinterface=q.getSinterface();k.tinterface=q.getTinterface();k.alias=q.getAlias();k.sdesc=q.getSdesc();k.tdesc=q.getTdesc();k.flow=q.getFlow();k.inflow=q.getInflow();k.outflow=q.getOutflow();k.speed=q.getSpeed();k.pkts=q.getPkts();k.broadcast=q.getBroadcast();k.bwusage=q.getBwusage();k.avgframeLen=q.getAvgframeLen();k.error=q.getError();k.warn=q.getWarn();k.pktserror=q.getPktserror();k.pktswarn=q.getPktswarn();k.broadcasterror=q.getBroadcasterror();k.broadcastwarn=q.getBroadcastwarn();k.bwusagerror=q.getBwusagerror();k.bwusagewarn=q.getBwusagewarn();k.selfalert=q.getSelfalert();k.portstate=q.getPortstate();lineidata[n]=k;linetextdata.push(k);k={}}node=r.selectAll(".node");this.createnodes();this.initlinks();this.inioverviewnode();this.inioverviewlink();this.initrect()},initlinks:function(){var c=this;var a=this.getLinkDisplayType();var b=c.getShowpc();var d=this.getHidelines();link=link.data(linetextdata);link.enter().append("path").attr("id",function(e){return"link"+e.lid}).attr("class1",function(e){if(e.source.otype==5||e.target.otype==5){return"pc"}else{return"nopc"}}).attr("d",function(l){var k=(l.source.nx+l.target.nx)/2;var g=(l.source.ny+l.target.ny)/2;var f=(l.source.nx+k)/2;var e=(l.source.ny+g)/2;if(a==6||a==1){return"M"+k+","+g+" "+f+","+e+" "+l.source.nx+","+l.source.ny}else{return"M"+l.source.nx+","+l.source.ny+" "+f+","+e+" "+k+","+g}}).style("visibility",function(e){if(e.source.otype==5||e.target.otype==5){if(b==1){return"visible"}else{return"hidden"}}else{return"visible"}}).style("marker-mid",function(e){if(d.indexOf(e.lid)>=0){return""}if(a==1){return"url(#end-arrow)"}else{return""}}).style("marker-end",function(e){if(d.indexOf(e.lid)>=0){return""}if(a==5){return"url(#end-arrow)"}else{return""}}).style("marker-start",function(e){if(d.indexOf(e.lid)>=0){return""}if(a==6){return"url(#end-arrow)"}else{return""}}).style("Stroke",function(f){var e=c.getlinkcolor(f);return e});link1=link1.data(linetextdata);link1.enter().append("path").attr("id",function(e){return"link1"+e.lid}).attr("class1",function(e){if(e.source.otype==5||e.target.otype==5){return"pc"}else{return"nopc"}}).attr("d",function(l){var g=(l.source.nx+l.target.nx)/2;var e=(l.source.ny+l.target.ny)/2;var k=(g+l.target.nx)/2;var f=(e+l.target.ny)/2;if(a==6){return"M"+l.target.nx+","+l.target.ny+" "+k+","+f+" "+g+","+e}else{return"M"+g+","+e+" "+k+","+f+" "+l.target.nx+","+l.target.ny}}).style("visibility",function(e){if(e.source.otype==5||e.target.otype==5){if(b==1){return"visible"}else{return"hidden"}}else{return"visible"}}).style("marker-mid",function(e){if(d.indexOf(e.lid)>=0){return""}if(a==1){return"url(#end-arrow)"}else{return""}}).style("Stroke",function(f){var e=c.getlinkcolor(f);return e});linktip=linktip.data(linetextdata);linktip.enter().append("line").attr("id",function(e){return e.lid}).attr("class1",function(e){if(e.source.otype==5||e.target.otype==5){return"pc"}else{return"nopc"}}).style("visibility",function(e){if(e.source.otype==5||e.target.otype==5){if(b==1){return"visible"}else{return"hidden"}}else{return"visible"}}).attr("x1",function(e){return e.source.nx}).attr("y1",function(e){return e.source.ny}).attr("x2",function(e){return e.target.nx}).attr("y2",function(e){return e.target.ny}).style("stroke-width","16px").style("stroke","blue").style("stroke-opacity","0.0").on("contextmenu",this.contextlinkmenu);linktip.append("svg:title").text(function(f){var e;var g;if(f.sdesc==""){e=f.source.localip+":"+f.sinterface}else{e=f.source.localip+":"+f.sinterface+"["+f.sdesc+"]"}if(f.tdesc==""){g=f.target.localip+":"+f.tinterface}else{g=f.target.localip+":"+f.tinterface+"["+f.tdesc+"]"}return linktips.replace("p1",e).replace("p2",g).replace("p3",f.flow+" Kbps").replace("p4",f.pkts+" Pkts/s").replace("p5",f.broadcast+" Pkts/s").replace("p6",f.bwusage+"% (100Mbps)").replace("p7",f.avgframeLen+" Byte/Pkt").replace("p8",f.outflow+" Kbps").replace("p9",f.inflow+" Kbps")});linktext=linktext.data(linetextdata);linktext.enter().append("text").attr("id",function(e){return"text2link"+e.lid}).attr("x",function(e){return(e.source.nx+e.target.nx)/2}).attr("y",function(e){return(e.source.ny+e.target.ny)/2}).attr("class1",function(e){if(e.source.otype==5||e.target.otype==5){return"pc"}else{return"nopc"}}).attr("transform",function(e){angle1=c.getAngle(e.source.nx,e.source.ny,e.target.nx,e.target.ny);return"rotate("+angle1+" "+((e.source.nx+e.target.nx)/2)+","+((e.source.ny+e.target.ny)/2)+")"}).attr("dy","-6").style("stroke-width","2px").style("cursor","default").style("stroke-linejoin","round").style("font-size","12px").style("font-weight","bold").style("fill",function(e){return"#000000"}).style("visibility",function(e){if(e.source.otype==5||e.target.otype==5){if(b==1){return"visible"}else{return"hidden"}}else{return"visible"}}).style("Stroke","none").style("text-anchor","middle").text(function(e){switch(a){case 2:return e.pkts+"Pkts/s";case 3:return e.broadcast+"Pkts/s";case 4:return e.bwusage+"% (100Mbps)";case 5:return e.outflow+"Kbps";case 6:return e.inflow+"Kbps";default:return""}});linkintext=linkintext.data(linetextdata);linkintext.enter().append("text").attr("id",function(e){return"text2linkin"+e.lid}).attr("x",function(f){var e=(f.source.nx+f.target.nx)/2;return(f.source.nx+e)/2}).attr("y",function(f){var e=(f.source.ny+f.target.ny)/2;return(f.source.ny+e)/2}).attr("class1",function(e){if(e.source.otype==5||e.target.otype==5){return"pc"}else{return"nopc"}}).attr("transform",function(l){angle1=c.getAngle(l.source.nx,l.source.ny,l.target.nx,l.target.ny);var k=(l.source.nx+l.target.nx)/2;var g=(l.source.ny+l.target.ny)/2;var f=(l.source.nx+k)/2;var e=(l.source.ny+g)/2;return"rotate("+angle1+" "+f+","+e+")"}).attr("dy","-6").style("stroke-width","2px").style("cursor","default").style("stroke-linejoin","round").style("font-size","12px").style("font-weight","bold").style("fill",function(e){return"#000000"}).style("visibility",function(e){if(e.source.otype==5||e.target.otype==5){if(b==1){return"visible"}else{return"hidden"}}else{return"visible"}}).style("Stroke","none").style("text-anchor","middle").text(function(e){if(a==1){return e.inflow+"Kbps"}else{return""}});linkouttext=linkouttext.data(linetextdata);linkouttext.enter().append("text").attr("id",function(e){return"text2linkout"+e.lid}).attr("x",function(g){var e=(g.source.nx+g.target.nx)/2;var f=(e+g.target.nx)/2;return f}).attr("y",function(g){var e=(g.source.ny+g.target.ny)/2;var f=(e+g.target.ny)/2;return f}).attr("class1",function(e){if(e.source.otype==5||e.target.otype==5){return"pc"}else{return"nopc"}}).attr("transform",function(l){angle1=c.getAngle(l.source.nx,l.source.ny,l.target.nx,l.target.ny);var g=(l.source.nx+l.target.nx)/2;var e=(l.source.ny+l.target.ny)/2;var k=(g+l.target.nx)/2;var f=(e+l.target.ny)/2;return"rotate("+angle1+" "+k+","+f+")"}).attr("dy","-6").style("stroke-width","2px").style("cursor","default").style("stroke-linejoin","round").style("font-size","12px").style("font-weight","bold").style("fill",function(e){return"#000000"}).style("visibility",function(e){if(e.source.otype==5||e.target.otype==5){if(b==1){return"visible"}else{return"hidden"}}else{return"visible"}}).style("Stroke","none").style("text-anchor","middle").text(function(e){if(a==1){return e.outflow+"Kbps"}else{return""}})},LocateNode:function(a){var f=null;for(var b=0;b<nodedata.length;b++){if(nodedata[b].localip==a){f=nodedata[b];break}}this._UpdateNode=null;if(f!=null){var e=d3.select("#"+f.sid).node();this._UpdateNode=e;var g=e.parentNode;d3.select(g).classed("selected",true);this._UpdateCount=0;this._Timer1=new rwt.client.Timer(500);this._Timer1.addEventListener("interval",this.changeColor,this);this._Timer1.start();var d=f.nx;if(f.nx>120){d=f.nx-120}var c=f.ny;if(f.ny>120){c=f.ny-120}maindiv.scrollLeft=d;maindiv.scrollTop=c}else{}},changeColor:function(){try{this._UpdateCount=this._UpdateCount+1;if(this._UpdateCount>10){d3.select(this._UpdateNode).style("stroke","#999");d3.select(this._UpdateNode).style("stroke-width","2");d3.select(this._UpdateNode).style("stroke-dasharray","2,2");this._Timer1.stop();this._UpdateCount=0}else{if(this._UpdateTag==0){this._UpdateTag=1;d3.select(this._UpdateNode).style("stroke-dasharray","none");d3.select(this._UpdateNode).style("stroke-width","4");d3.select(this._UpdateNode).style("stroke","#00FF00")}else{d3.select(this._UpdateNode).style("stroke","#FF0000");d3.select(this._UpdateNode).style("stroke-width","6");d3.select(this._UpdateNode).style("stroke-dasharray","none");this._UpdateTag=0}this._Timer1.stop();this._Timer1.restart()}}catch(a){}},DealLinks:function(){var b=30;var C=this;var o=this.getLinkDisplayType();var r=this.getHidelines();var D=false;var p=new Array();var F=new Array();var f=new Array();linetextdata.map(function(T,n){p.push(T);F.push(T)});p.map(function(W,T){var n=new Array();for(var U=0;U<F.length;U++){var V=F[U];if(V!=undefined){if(W.source.sid==V.source.sid&&W.target.sid==V.target.sid){n.push(V);delete F[U]}else{if(W.source.sid==V.target.sid&&W.target.sid==V.source.sid){n.push(V);delete F[U]}}}}if(n.length>1){f.push(n)}});if(f.length<1){return}var D=false;var v=new Array();for(var O=0;O<f.length;O++){var g=f[O][0].source;var q=f[O][0].target;var k=Math.sqrt(Math.pow((g.ny-q.ny),2)+Math.pow((g.nx-q.nx),2));var S=Math.abs(g.ny-q.ny)/k;var R=Math.abs(g.nx-q.nx)/k;var u=new Array(2);if((g.ny-q.ny)*(g.nx-q.nx)>0){D=true}u[0]=S;u[1]=R;v.push(u)}if(f.length!=v.length){return}var m=new Array();for(var K=0;K<f.length;K++){var e=f[K];if(e.length<1){continue}var s=v[K];if(D){for(var O=0;O<e.length;O++){var N={};var Q=e[O];var M;var L;var G;var E;if(O%2==0){M=Q.source.nx+(s[0]*O/2*b);L=Q.source.ny+(-s[1]*O/2*b);G=Q.target.nx+(s[0]*O/2*b);E=Q.target.ny+(-s[1]*O/2*b)}else{M=Q.source.nx+(-s[0]*O/2*b);L=Q.source.ny+(s[1]*O/2*b);G=Q.target.nx+(-s[0]*O/2*b);E=Q.target.ny+(s[1]*O/2*b)}N.lid=Q.lid;N.sourcex=M;N.sourcey=L;N.targetx=G;N.targety=E;m.push(N)}}else{for(var O=0;O<e.length;O++){var N={};var Q=e[O];var M;var L;var G;var E;if(O%2==0){M=Q.source.nx+(s[0]*O/2*b);L=Q.source.ny+(s[1]*O/2*b);G=Q.target.nx+(s[0]*O/2*b);var E=Q.target.ny+(s[1]*O/2*b)}else{M=Q.source.nx+(-s[0]*O/2*b);L=Q.source.ny+(-s[1]*O/2*b);G=Q.target.nx+(-s[0]*O/2*b);E=Q.target.ny+(-s[1]*O/2*b)}N.lid=Q.lid;N.sourcex=M;N.sourcey=L;N.targetx=G;N.targety=E;m.push(N)}}}for(var P=0;P<m.length;P++){var I=m[P];d3.select("#"+I.lid).attr("x1",I.sourcex).attr("y1",I.sourcey).attr("x2",I.targetx).attr("y2",I.targety);var J=(I.sourcex+I.targetx)/2;var H=(I.sourcey+I.targety)/2;var B=(I.sourcex+J)/2;var z=(I.sourcey+H)/2;var l="M"+J+","+H+" "+B+","+z+" "+I.sourcex+","+I.sourcey;d3.select("#link"+I.lid).attr("d",l).style("marker-mid",function(n){if(r.indexOf(n.lid)>=0){return""}if(o==1){return"url(#end-arrow)"}else{return""}}).style("marker-end",function(n){if(o==5){return""}else{return""}}).style("marker-start",function(n){if(r.indexOf(n.lid)>=0){return""}if(o==6){return"url(#end-arrow)"}else{return""}});var d=(I.sourcex+I.targetx)/2;var c=(I.sourcey+I.targety)/2;var a=(d+I.targetx)/2;var A=(c+I.targety)/2;var t="M"+d+","+c+" "+a+","+A+" "+I.targetx+","+I.targety;d3.select("#link1"+I.lid).attr("d",t).style("marker-start",function(n){if(r.indexOf(n.lid)>=0){return""}if(o==5){return"url(#end-arrow)"}else{return""}});if(o==1){d3.select("#text2link"+I.lid).style("visibility","hidden");if(r.indexOf(I.lid)>=0){}else{d3.select("#text2linkin"+I.lid).attr("x",B).attr("y",z).style("visibility","visible").attr("transform",function(n){angle=C.getAngle(I.sourcex,I.sourcey,I.targetx,I.targety);return"rotate("+angle+" "+(B)+","+(z)+")"});d3.select("#text2linkout"+I.lid).attr("x",a).attr("y",A).style("visibility","visible").attr("transform",function(n){angle=C.getAngle(I.sourcex,I.sourcey,I.targetx,I.targety);return"rotate("+angle+" "+(a)+","+(A)+")"})}}else{d3.select("#text2linkin"+I.lid).style("visibility","hidden");d3.select("#text2linkout"+I.lid).style("visibility","hidden");if(r.indexOf(I.lid)>=0){}else{d3.select("#text2link"+I.lid).style("visibility","visible").attr("x",d).attr("y",c).attr("transform",function(n){angle=C.getAngle(I.sourcex,I.sourcey,I.targetx,I.targety);return"rotate("+angle+" "+(d)+","+(c)+")"})}}}},updatelinks:function(){var b=this;var a=this.getLinkDisplayType();link.data(linetextdata).attr("d",function(k){var g=(k.source.nx+k.target.nx)/2;var f=(k.source.ny+k.target.ny)/2;var e=(k.source.nx+g)/2;var c=(k.source.ny+f)/2;if(a==6){return"M"+g+","+f+" "+e+","+c+" "+k.source.nx+","+k.source.ny}else{return"M"+k.source.nx+","+k.source.ny+" "+e+","+c+" "+g+","+f}}).style("Stroke",function(e){var c=b.getlinkcolor(e);return c});link1.data(linetextdata).attr("d",function(k){var f=(k.source.nx+k.target.nx)/2;var c=(k.source.ny+k.target.ny)/2;var g=(f+k.target.nx)/2;var e=(c+k.target.ny)/2;if(a==6){return"M"+k.target.nx+","+k.target.ny+" "+g+","+e+" "+f+","+c}else{return"M"+f+","+c+" "+g+","+e+" "+k.target.nx+","+k.target.ny}}).style("Stroke",function(e){var c=b.getlinkcolor(e);return c});linktip.data(linetextdata).attr("id",function(c){return c.lid}).attr("x1",function(c){return c.source.nx}).attr("y1",function(c){return c.source.ny}).attr("x2",function(c){return c.target.nx}).attr("y2",function(c){return c.target.ny});linktip.data(linetextdata).text(function(c){});linktip.append("svg:title").text(function(m){var n=m.flow;var o=" Kbps";if(n>1024){n=n/1024;o=" Mbps";if(n>1024){n=n/1024;o=" Gbps";if(n>1024){n=n/1024;o=" Tbps"}}}var f=m.outflow;var c=" Kbps";if(f>1024){f=f/1024;c=" Mbps";if(f>1024){f=f/1024;c=" Gbps";if(f>1024){f=f/1024;c=" Tbps"}}}var e=m.inflow;var l=" Kbps";if(e>1024){e=e/1024;l=" Mbps";if(e>1024){e=e/1024;l=" Gbps";if(e>1024){e=e/1024;l=" Tbps"}}}var k;var g;if(m.sdesc==""||m.sdesc==undefined){k=m.source.localip+":"+m.sinterface}else{k=m.source.localip+":"+m.sinterface+"["+m.sdesc+"]"}if(m.tdesc==""||m.tdesc==undefined){g=m.target.localip+":"+m.tinterface}else{g=m.target.localip+":"+m.tinterface+"["+m.tdesc+"]"}return linktips.replace("p1",k).replace("p2",g).replace("p3",Math.round(n*10)/10+o).replace("p4",m.pkts+" Pkts/s").replace("p5",m.broadcast+" Pkts/s").replace("p6",m.bwusage+"% (100Mbps)").replace("p7",m.avgframeLen+" Byte/Pkt").replace("p8",Math.round(f*10)/10+c).replace("p9",Math.round(e*10)/10+l)});linktext.data(linetextdata).attr("x",function(c){return(c.source.nx+c.target.nx)/2}).attr("y",function(c){return(c.source.ny+c.target.ny)/2}).attr("transform",function(c){angle1=b.getAngle(c.source.nx,c.source.ny,c.target.nx,c.target.ny);return"rotate("+angle1+" "+((c.source.nx+c.target.nx)/2)+","+((c.source.ny+c.target.ny)/2)+")"}).style("fill",function(c){return"#000000"}).style("Stroke","none").style("text-anchor","middle").text(function(k){switch(a){case 2:return k.pkts+"Pkts/s";case 3:return k.broadcast+"Pkts/s";case 4:return k.bwusage+"";case 5:var f=k.outflow;var e=" Kbps";if(f>1024){f=f/1024;e=" Mbps";if(f>1024){f=f/1024;e=" Gbps";if(f>1024){f=f/1024;e=" Tbps"}}}return Math.round(f*10)/10+e;case 6:var c=k.inflow;var g=" Kbps";if(c>1024){c=c/1024;g=" Mbps";if(c>1024){c=c/1024;g=" Gbps";if(c>1024){c=c/1024;g=" Tbps"}}}return Math.round(c*10)/10+g;default:return""}});linkintext.data(linetextdata).attr("x",function(e){var c=(e.source.nx+e.target.nx)/2;return(e.source.nx+c)/2}).attr("y",function(e){var c=(e.source.ny+e.target.ny)/2;return(e.source.ny+c)/2}).attr("transform",function(k){angle1=b.getAngle(k.source.nx,k.source.ny,k.target.nx,k.target.ny);var g=(k.source.nx+k.target.nx)/2;var f=(k.source.ny+k.target.ny)/2;var e=(k.source.nx+g)/2;var c=(k.source.ny+f)/2;return"rotate("+angle1+" "+e+","+c+")"}).style("fill",function(c){return"#000000"}).style("Stroke","none").style("text-anchor","middle").text(function(f){var c=f.inflow;var e=" Kbps";if(c>1024){c=c/1024;e=" Mbps";if(c>1024){c=c/1024;e=" Gbps";if(c>1024){c=c/1024;e=" Tbps"}}}return Math.round(c*10)/10+e});linkouttext.data(linetextdata).attr("x",function(f){var c=(f.source.nx+f.target.nx)/2;var e=(c+f.target.nx)/2;return e}).attr("y",function(f){var c=(f.source.ny+f.target.ny)/2;var e=(c+f.target.ny)/2;return e}).attr("transform",function(k){angle1=b.getAngle(k.source.nx,k.source.ny,k.target.nx,k.target.ny);var f=(k.source.nx+k.target.nx)/2;var c=(k.source.ny+k.target.ny)/2;var g=(f+k.target.nx)/2;var e=(c+k.target.ny)/2;return"rotate("+angle1+" "+g+","+e+")"}).style("fill",function(c){return"#000000"}).style("Stroke","none").style("text-anchor","middle").text(function(f){var e=f.outflow;var c=" Kbps";if(e>1024){e=e/1024;c=" Mbps";if(e>1024){e=e/1024;c=" Gbps";if(e>1024){e=e/1024;c=" Tbps"}}}return Math.round(e*10)/10+c});b.updateoverviewlink()},deletelinks:function(){var a=this;link=link.data(linetextdata,function(b){return(b.lid)});link.exit().remove();link1=link1.data(linetextdata,function(b){return(b.lid)});link1.exit().remove();linktip=linktip.data(linetextdata,function(b){return(b.lid)});linktip.exit().remove();linktext=linktext.data(linetextdata,function(b){return(b.lid)});linktext.exit().remove();linkintext=linkintext.data(linetextdata,function(b){return(b.lid)});linkintext.exit().remove();linkouttext=linkouttext.data(linetextdata,function(b){return(b.lid)});linkouttext.exit().remove();a.updateoverviewlink()},refreshnewline:function(){var b=this.getNewlinedata();var c=this;var a=b.lid;if(a==="nil"){if(typeof(linetempobj)=="undefined"){return}selectlink=linetempobj.lid;c.updatelinksdata(0);c.deletelinks()}else{linetempobj.lid=b.lid;linetempobj.sinterface=b.port1;linetempobj.tinterface=b.port2;lineidata[b.lid]=linetempobj;this.updatelinks()}},refreshpline:function(){var a=this.getPlinedata();lineidata[a.lid].sinterface=a.port1;lineidata[a.lid].tinterface=a.port2;lineidata[a.lid].sdesc=a.desc1;lineidata[a.lid].tdesc=a.desc2},updatelinksdata:function(b){if(b==0){for(i=0;i<linetextdata.length;i++){if(linetextdata[i].lid===selectlink){linetextdata.splice(i,1);break}}}else{if(b==1){var e=[];for(i=0;i<linetextdata.length;i++){if(linetextdata[i].source.sid===selectnode||linetextdata[i].target.sid===selectnode){}else{e.push(linetextdata[i])}}linetextdata=e}else{if(b==2){var e=[];for(i=0;i<linetextdata.length;i++){var c=true;var f=linetextdata[i].source.sid;var d=linetextdata[i].target.sid;for(j=0;j<selectnodes.length;j++){if(f===selectnodes[j]||d===selectnodes[j]){c=false}}if(c){e.push(linetextdata[i])}}linetextdata=e}else{if(b==3){var e=[];for(i=0;i<linetextdata.length;i++){var c=true;var a=true;var f=linetextdata[i].source.sid;var d=linetextdata[i].target.sid;for(j=0;j<selectnodes.length;j++){if(f===selectnodes[j]){c=false}if(d===selectnodes[j]){a=false}}if(c&&a){e.push(linetextdata[i])}else{if(c&&!a){linetextdata[i].target=newgroupnode;e.push(linetextdata[i])}if(a&&!c){linetextdata[i].source=newgroupnode;e.push(linetextdata[i])}}}linetextdata=e}}}}},deletenodes:function(){var a=this;node=node.data(nodedata,function(b){return(b.sid)});node.exit().remove();a.updateoverviewnode()},refreshpnode:function(){var b=this.getPnodedata();nodelinedata[b.nid].customname=b.cname;nodelinedata[b.nid].otype=b.ntype;var a="rwt-resources/topomap/Other_Blue.ico";switch(b.ntype){case 0:a="rwt-resources/topomap/SwitchRouter_Blue.ico";break;case 1:a="rwt-resources/topomap/Switch_Blue.ico";break;case 2:a="rwt-resources/topomap/Router_Blue.ico";break;case 3:a="rwt-resources/topomap/Firewall_Blue.ico";break;case 4:a="rwt-resources/topomap/Server_Blue.ico";break;case 5:a="rwt-resources/topomap/PC_Blue.ico";break;case 7:a="rwt-resources/topomap/HUB_Blue.ico";break;case 8:a="rwt-resources/topomap/noSnmp.png";break;case 9:a="rwt-resources/topomap/database.png";break;case 23:a="rwt-resources/topomap/APwifi.bmp";break;case 100:a="rwt-resources/topomap/Group_Blue.bmp";break;default:a="rwt-resources/topomap/Other_Blue.ico"}d3.select("#image"+b.nid).attr("xlink:href",a)},refreshalertdata:function(a,c){c.map(function(e,d){if(nodelinedata[e.nid]!==undefined){nodelinedata[e.nid].state=0}});var b=nodedata.filter(function(d){return d.otype==100});b.map(function(e,d){if(nodelinedata[e.sid]!==undefined){nodelinedata[e.sid].state=0}});a.map(function(e,d){if(nodelinedata[e.nid]!==undefined){nodelinedata[e.nid].state=e.state}b.map(function(f,g){if(f.factory.indexOf(e.ip)>=0){if(nodelinedata[f.sid]!==undefined){if(nodelinedata[f.sid].state!=1){nodelinedata[f.sid].state=e.state}}}})});nodealertimg.attr("xlink:href",function(e){switch(e.state){case 0:return"";case 1:return"rwt-resources/topomap/error.png";case 2:return"rwt-resources/topomap/warning.png";default:return""}})},updatenodesdata:function(b){if(b==0){for(i=0;i<nodedata.length;i++){if(nodedata[i].sid===selectnode){nodedata.splice(i,1);break}}}else{if(b==1){var a=[];for(i=0;i<nodedata.length;i++){var c=true;var d=nodedata[i].sid;for(j=0;j<selectnodes.length;j++){if(d===selectnodes[j]){c=false}}if(c){a.push(nodedata[i])}}nodedata=a}}},nudge:function(c,b){var a=this.getLinkDisplayType();node.filter(function(e){return e.selected}).attr("transform",function(g){var f=that1.getMaxX()-20;var e=that1.getMaxY()-20;g.nx+=c;g.ny+=b;if(g.nx>f){g.nx=f}if(g.ny>e){g.ny=e}if(g.ny<0){g.ny=0}nodelinedata[g.sid].nx=g.nx;nodelinedata[g.sid].ny=g.ny;return"translate("+g.nx+", "+g.ny+")"});link.filter(function(e){return e.source.selected}).attr("d",function(l){var k=(l.source.nx+l.target.nx)/2;var g=(l.source.ny+l.target.ny)/2;var f=(l.source.nx+k)/2;var e=(l.source.ny+g)/2;if(a==6||a==1){return"M"+k+","+g+" "+f+","+e+" "+l.source.nx+","+l.source.ny}else{return"M"+l.source.nx+","+l.source.ny+" "+f+","+e+" "+k+","+g}});link.filter(function(e){return e.target.selected}).attr("d",function(l){var k=(l.source.nx+l.target.nx)/2;var g=(l.source.ny+l.target.ny)/2;var f=(l.source.nx+k)/2;var e=(l.source.ny+g)/2;if(a==6||a==1){return"M"+k+","+g+" "+f+","+e+" "+l.source.nx+","+l.source.ny}else{return"M"+l.source.nx+","+l.source.ny+" "+f+","+e+" "+k+","+g}});link1.filter(function(e){return e.source.selected}).attr("d",function(l){var g=(l.source.nx+l.target.nx)/2;var e=(l.source.ny+l.target.ny)/2;var k=(g+l.target.nx)/2;var f=(e+l.target.ny)/2;if(a==6){return"M"+l.target.nx+","+l.target.ny+" "+k+","+f+" "+g+","+e}else{return"M"+g+","+e+" "+k+","+f+" "+l.target.nx+","+l.target.ny}});link1.filter(function(e){return e.target.selected}).attr("d",function(l){var g=(l.source.nx+l.target.nx)/2;var e=(l.source.ny+l.target.ny)/2;var k=(g+l.target.nx)/2;var f=(e+l.target.ny)/2;if(a==6){return"M"+l.target.nx+","+l.target.ny+" "+k+","+f+" "+g+","+e}else{return"M"+g+","+e+" "+k+","+f+" "+l.target.nx+","+l.target.ny}});linktip.filter(function(e){return e.source.selected}).attr("x1",function(e){return e.source.nx}).attr("y1",function(e){return e.source.ny});linktip.filter(function(e){return e.target.selected}).attr("x2",function(e){return e.target.nx}).attr("y2",function(e){return e.target.ny});linktext.filter(function(e){return(e.source.selected||e.target.selected)}).attr("x",function(e){return(e.source.nx+e.target.nx)/2}).attr("y",function(e){return(e.source.ny+e.target.ny)/2}).attr("transform",function(e){angle=that1.getAngle(e.source.nx,e.source.ny,e.target.nx,e.target.ny);return"rotate("+angle+" "+((e.source.nx+e.target.nx)/2)+","+((e.source.ny+e.target.ny)/2)+")"});linkintext.filter(function(e){return(e.source.selected||e.target.selected)}).attr("x",function(f){var e=(f.source.nx+f.target.nx)/2;return(f.source.nx+e)/2}).attr("y",function(f){var e=(f.source.ny+f.target.ny)/2;return(f.source.ny+e)/2}).attr("transform",function(l){angle=that1.getAngle(l.source.nx,l.source.ny,l.target.nx,l.target.ny);var k=(l.source.nx+l.target.nx)/2;var g=(l.source.ny+l.target.ny)/2;var f=(l.source.nx+k)/2;var e=(l.source.ny+g)/2;return"rotate("+angle+" "+f+","+e+")"});linkouttext.filter(function(e){return(e.source.selected||e.target.selected)}).attr("x",function(g){var e=(g.source.nx+g.target.nx)/2;var f=(e+g.target.nx)/2;return f}).attr("y",function(g){var e=(g.source.ny+g.target.ny)/2;var f=(e+g.target.ny)/2;return f}).attr("transform",function(l){angle=that1.getAngle(l.source.nx,l.source.ny,l.target.nx,l.target.ny);var g=(l.source.nx+l.target.nx)/2;var e=(l.source.ny+l.target.ny)/2;var k=(g+l.target.nx)/2;var f=(e+l.target.ny)/2;return"rotate("+angle+" "+k+","+f+")"});this.DealLinks();d3.event.preventDefault()},createnodes:function(){var d=this;function e(){mousedownnode=null;mouseupnode=null}var c=d3.behavior.drag().on("dragstart",function(){if(d3.select(this).classed("selected")){drag_line.classed("hidden",true).style("marker-end","");e()}}).on("drag",function(f){if(d3.select(this).classed("selected")&&!dragup){d.nudge(d3.event.dx,d3.event.dy)}else{}}).on("dragend",function(f){if(mousedownnode){if(mousedownnode===f){dragup=true}if(!d3.select(this).classed("selected")){d3.event.defaultPrevented()}drag_line.classed("hidden",true).style("marker-end","")}e();that1.updateoverviewnode();that1.updateoverviewlink()});node=node.data(nodedata);nodeenter=node.enter().append("g");var a=d.getShowpc();nodeenter.attr("class1",function(f){if(f.otype==5){return"pc"}else{return"nopc"}}).attr("class","node").attr("transform",function(f){return"translate("+f.nx+", "+f.ny+")"}).style("visibility",function(f){if(f.otype==5){if(a==1){return"visible"}else{return"hidden"}}else{return"visible"}}).on("mouseup",function(k){nodeclick=true;if(!k.selected){if(!shiftKey){node.classed("selected",function(l){return l.selected=k===l})}else{d3.select(this).classed("selected",k.selected=true)}}if(!mousedownnode){return}mouseupnode=k;if(mouseupnode===mousedownnode){drag_line.classed("hidden",true).style("marker-end","");e();return}var g=Math.floor((Math.random()*100)+1);var f=new Array();f.push(mousedownnode);f.push(mouseupnode);that1._savedata("addline",f);linetempobj={};linetempobj.source=mousedownnode;linetempobj.target=mouseupnode;linetempobj.lid="test"+g;linetempobj.sinterface="6";linetempobj.tinterface="0";linetempobj.flow=20;linetempobj.inflow=10;linetempobj.outflow=10;linetempobj.pkts=30;linetempobj.broadcast=3;linetempobj.bwusage=0;linetempobj.avgframeLen=0;linetempobj.error=100;linetempobj.warn=80;linetextdata.push(linetempobj);that1.initlinks();drag_line.classed("hidden",true).style("marker-end","");e()}).on("mousedown",function(k){dragup=false;var f=this;var g=d3.select(this).classed("selected");if(!g){k.selected=false}if(!k.selected){mousedownnode=k;drag_line.style("marker-end","url(#end-arrow)").classed("hidden",false).attr("d","M"+k.nx+","+k.ny+"L"+k.nx+","+k.ny)}}).call(c);nodeenter.append("text").attr("class","node2text").attr("x",0).attr("y",26).style("fill","#000000").style("stroke","#none").style("font-size","14px").style("cursor","default").style("text-anchor","middle").text(function(f){switch(nodeshowtype){case 2:return f.name;case 3:return f.model;case 4:return f.customname;default:return f.localip}});nodetext=d3.selectAll(".node2text");nodeenter.append("svg:image").attr("x",-16).attr("y",-16).attr("width",32).attr("height",32).attr("id",function(f){return"image"+f.sid}).attr("xlink:href",function(f){switch(f.otype){case 0:return"rwt-resources/topomap/SwitchRouter_Blue.ico";case 1:return"rwt-resources/topomap/Switch_Blue.ico";case 2:return"rwt-resources/topomap/Router_Blue.ico";case 3:return"rwt-resources/topomap/Firewall_Blue.ico";case 4:return"rwt-resources/topomap/Server_Blue.ico";case 5:return"rwt-resources/topomap/PC_Blue.ico";case 7:return"rwt-resources/topomap/HUB_Blue.ico";case 8:return"rwt-resources/topomap/noSnmp.png";case 9:return"rwt-resources/topomap/database.png";case 23:return vvimage="rwt-resources/topomap/APwifi.bmp";case 100:return"rwt-resources/topomap/Group_Blue.bmp";default:return"rwt-resources/topomap/Other_Blue.ico"}});var b=nodeenter.append("rect").attr("x",-16).attr("y",-16).attr("width",32).attr("height",32).attr("id",function(f){return f.sid}).style("stroke-width","2").style("stroke-dasharray","2,2").on("dblclick",function(f){if(f.otype==100){that1._savedata("looksubchart",f.name)}else{}}).on("contextmenu",d.contextnodemenu);b.append("svg:title").text(function(f){switch(f.otype){case 100:return grouptips.replace("p1",f.localip).replace("p2",f.mac).replace("p3",f.factory);default:return nodetips.replace("p1",f.localip).replace("p2",f.mac).replace("p3",f.name).replace("p4",f.customname).replace("p5",f.factory).replace("p6",f.model)}});nodeenter.append("svg:image").attr("class","node2alert").attr("x",4).attr("y",4).attr("width",12).attr("height",12).attr("xlink:href","");nodealertimg=d3.selectAll(".node2alert")},contextnodemenu:function(c,f){var d=d3.selectAll(".selected");var o=d[0].length;var b=d3.select(maindiv).node();var e=d3.mouse(b);var a=e[0];var k=e[1];nodeclick=true;if(o>1){selectnode=d3.select(this).attr("id");mousexx=a;mouseyy=k;d3.select("#submenu").style("position","absolute").style("left",a+"px").style("top",k+"px").style("display","inline-block").on("mouseleave",function(){d3.select("#submenu").style("display","none")});d3.event.preventDefault()}else{if(c.otype==100){selectgroup=c.name;selectnode=c.sid;mousexx=a;mouseyy=k;d3.select("#groupmenu").style("position","absolute").style("left",a+"px").style("top",k+"px").style("display","inline-block").on("mouseleave",function(){d3.select("#groupmenu").style("display","none")});d3.event.preventDefault()}else{selectnode=c.sid;var m=this.parentNode;if(m.style.visibility=="hidden"){return}var g=that1.getCompHeight();var n=k+30*nodemenucount;if(n>g){var l=n-g;k=k-l}d3.select("#mymenu").style("position","absolute").style("left",a+"px").style("top",k+"px").style("display","inline-block").on("mouseleave",function(){d3.select("#mymenu").style("display","none")});d3.event.preventDefault()}}},updatesubchart:function(){var a=this;a.updatelinksdata(3);a.updatenodesdata(1);a.deletelinks();a.deletenodes();a.createnodes();a.updatelinks()},udatetopochart:function(d){var b=this;var a={};var c={};b.updatenodesdata(0);b.updatelinksdata(1);b.deletelinks();b.deletenodes();d.map(function(l,g){var k=l.jid;if(k.indexOf("n")==0){a.sid=k;a.nx=l.nx-16;a.ny=l.ny-16;a.otype=l.type;a.localip=l.ip;a.mac=l.mac;a.name=l.name;a.customname=l.customname;a.factory=l.manufact;a.model=l.model;nodelinedata[k]=a;nodedata.push(a);a={}}else{var f=l.source;var e=l.target;c.source=nodelinedata[f];c.target=nodelinedata[e];c.lid=k;c.sinterface=l.sinterface;c.tinterface=l.tinterface;c.flow=l.flow;c.outflow=0;c.inflow=0;c.pkts=0;c.broadcast=0;c.bwusage=0;c.avgframeLen=0;c.error=l.error;c.warn=l.warn;linetextdata.push(c);c={}}});b.createnodes();b.initlinks();b.updateoverviewnode();b.updateoverviewlink()},getlinkcolor:function(b){var a=this.getLinkDisplayType();switch(a){case 2:if(b.pkts>b.pktserror){return"red"}if(b.pkts>b.pktswarn){return"#FFD306"}if(b.pkts>0){return"#00DB00"}if(b.pkts===0){return"#272727"}case 3:if(b.broadcast>b.broadcasterror){return"red"}if(b.broadcast>b.broadcastwarn){return"#FFD306"}if(b.broadcast>0){return"#00DB00"}if(b.broadcast===0){return"#272727"}case 4:if(b.bwusage>b.bwusagerror){return"red"}if(b.bwusage>b.bwusagewarn){return"#FFD306"}if(b.bwusage>0){return"#00DB00"}if(b.bwusage===0){return"#272727"}case 5:if(b.outflow>b.error){return"red"}if(b.outflow>b.warn){return"#FFD306"}if(b.outflow>0){return"#00DB00"}if(b.outflow===0){return"#272727"}case 6:if(b.inflow>b.error){return"red"}if(b.inflow>b.warn){return"#FFD306"}if(b.inflow>0){return"#00DB00"}if(b.inflow===0){return"#272727"}default:if(b.flow>b.error){return"red"}if(b.flow>b.warn){return"#FFD306"}if(b.flow>0){return"#00DB00"}if(b.flow===0){return"#272727"}}},toporedrawlayout:function(k){that=this;var c=k.pop();var b=Math.abs(c.nx);var a=Math.abs(c.ny);var d=k.pop();var g=Math.abs(d.nx+64+b);var f=Math.abs(d.ny+64+a);if(g>2700){that.svg.attr("width",g+"")}if(f>2200){that.svg.attr("height",f+"")}this.setMaxX(g);this.setMaxY(f);k.map(function(m,l){nodelinedata[m.nid].nx=m.nx+64+b;nodelinedata[m.nid].ny=m.ny+64+a});node.data(nodedata).attr("transform",function(l){return"translate("+l.nx+", "+l.ny+")"});link.attr("d",function(p){var o=(p.source.nx+p.target.nx)/2;var n=(p.source.ny+p.target.ny)/2;var m=(p.source.nx+o)/2;var l=(p.source.ny+n)/2;if(linkshowtype==6||linkshowtype==1){return"M"+o+","+n+" "+m+","+l+" "+p.source.nx+","+p.source.ny}else{return"M"+p.source.nx+","+p.source.ny+" "+m+","+l+" "+o+","+n}});link1.attr("d",function(p){var n=(p.source.nx+p.target.nx)/2;var l=(p.source.ny+p.target.ny)/2;var o=(n+p.target.nx)/2;var m=(l+p.target.ny)/2;if(linkshowtype==6){return"M"+p.target.nx+","+p.target.ny+" "+o+","+m+" "+n+","+l}else{return"M"+n+","+l+" "+o+","+m+" "+p.target.nx+","+p.target.ny}});linktip.attr("x1",function(l){return l.source.nx}).attr("y1",function(l){return l.source.ny}).attr("x2",function(l){return l.target.nx}).attr("y2",function(l){return l.target.ny});linktext.attr("x",function(l){return(l.source.nx+l.target.nx)/2}).attr("y",function(l){return(l.source.ny+l.target.ny)/2}).attr("transform",function(l){angle=that.getAngle(l.source.nx,l.source.ny,l.target.nx,l.target.ny);return"rotate("+angle+" "+((l.source.nx+l.target.nx)/2)+","+((l.source.ny+l.target.ny)/2)+")"});linkintext.attr("x",function(m){var l=(m.source.nx+m.target.nx)/2;return(m.source.nx+l)/2}).attr("y",function(m){var l=(m.source.ny+m.target.ny)/2;return(m.source.ny+l)/2}).attr("transform",function(p){angle=that.getAngle(p.source.nx,p.source.ny,p.target.nx,p.target.ny);var o=(p.source.nx+p.target.nx)/2;var n=(p.source.ny+p.target.ny)/2;var m=(p.source.nx+o)/2;var l=(p.source.ny+n)/2;return"rotate("+angle+" "+m+","+l+")"});linkouttext.attr("x",function(n){var l=(n.source.nx+n.target.nx)/2;var m=(l+n.target.nx)/2;return m}).attr("y",function(n){var l=(n.source.ny+n.target.ny)/2;var m=(l+n.target.ny)/2;return m}).attr("transform",function(p){angle=that.getAngle(p.source.nx,p.source.ny,p.target.nx,p.target.ny);var n=(p.source.nx+p.target.nx)/2;var l=(p.source.ny+p.target.ny)/2;var o=(n+p.target.nx)/2;var m=(l+p.target.ny)/2;return"rotate("+angle+" "+o+","+m+")"});w=this.getMaxX();h=this.getMaxY();scaleFactor=Math.min(overvieww/w,overviewh/h);var e=d3.select("#overview");e.attr("transform","scale("+scaleFactor+")");this.updateoverviewnode();this.updateoverviewlink();this.DealLinks()},refreshData:function(d){var a=this.getLinkDisplayType();d.map(function(f,e){if(lineidata[f.lid]!==undefined){lineidata[f.lid].flow=f.flow;lineidata[f.lid].outflow=f.outflow;lineidata[f.lid].inflow=f.inflow;lineidata[f.lid].speed=f.speed;lineidata[f.lid].pkts=f.pkts;lineidata[f.lid].alias=f.alias;lineidata[f.lid].broadcast=f.broadcast;lineidata[f.lid].bwusage=f.bwusage;lineidata[f.lid].avgframeLen=f.avgframeLen;lineidata[f.lid].portstate=f.portstate}});var c=this.getHidelines();link=link.data(linetextdata).attr("d",function(l){var k=(l.source.nx+l.target.nx)/2;var g=(l.source.ny+l.target.ny)/2;var f=(l.source.nx+k)/2;var e=(l.source.ny+g)/2;if(a==6||a==1){return"M"+k+","+g+" "+f+","+e+" "+l.source.nx+","+l.source.ny}else{return"M"+l.source.nx+","+l.source.ny+" "+f+","+e+" "+k+","+g}}).style("Stroke",function(e){switch(a){case 2:if(e.pkts>e.pktserror){return"red"}if(e.pkts>e.pktswarn){return"#FFD306"}if(e.pkts>0){return"#00DB00"}if(e.pkts===0&&e.portstate===0){return"#272727"}else{return"#00DB00"}case 3:if(e.broadcast>e.broadcasterror){return"red"}if(e.broadcast>e.broadcastwarn){return"#FFD306"}if(e.broadcast>0){return"#00DB00"}if(e.broadcast===0&&e.portstate===0){return"#272727"}else{return"#00DB00"}case 4:if(e.bwusage>e.bwusagerror){return"red"}if(e.bwusage>e.bwusagewarn){return"#FFD306"}if(e.bwusage>0){return"#00DB00"}if(e.bwusage===0&&e.portstate===0){return"#272727"}else{return"#00DB00"}default:if(e.flow>e.error){return"red"}if(e.flow>e.warn){return"#FFD306"}if(e.flow>0){return"#00DB00"}if(e.flow===0&&e.portstate===0){return"#272727"}else{return"#00DB00"}}}).style("stroke-width",function(g){var f=g.flow;var e="1px";if(f>1024){f=f/1024;e="2px";if(f>1024){f=f/1024;e="3px";if(f>1024){f=f/1024;e="4px"}}}return e});link1=link1.data(linetextdata).attr("d",function(l){var g=(l.source.nx+l.target.nx)/2;var e=(l.source.ny+l.target.ny)/2;var k=(g+l.target.nx)/2;var f=(e+l.target.ny)/2;if(a==6){return"M"+l.target.nx+","+l.target.ny+" "+k+","+f+" "+g+","+e}else{return"M"+g+","+e+" "+k+","+f+" "+l.target.nx+","+l.target.ny}}).style("Stroke",function(e){switch(a){case 2:if(e.pkts>e.pktserror){return"red"}if(e.pkts>e.pktswarn){return"#FFD306"}if(e.pkts>0){return"#00DB00"}if(e.pkts===0&&e.portstate===0){return"#272727"}else{return"#00DB00"}case 3:if(e.broadcast>e.broadcasterror){return"red"}if(e.broadcast>e.broadcastwarn){return"#FFD306"}if(e.broadcast>0){return"#00DB00"}if(e.broadcast===0&&e.portstate===0){return"#272727"}else{return"#00DB00"}case 4:if(e.bwusage>e.bwusagerror){return"red"}if(e.bwusage>e.bwusagewarn){return"#FFD306"}if(e.bwusage>0){return"#00DB00"}if(e.bwusage===0&&e.portstate===0){return"#272727"}else{return"#00DB00"}default:if(e.flow>e.error){return"red"}if(e.flow>e.warn){return"#FFD306"}if(e.flow>0){return"#00DB00"}if(e.flow===0&&e.portstate===0){return"#272727"}else{return"#00DB00"}}}).style("stroke-width",function(g){var f=g.flow;var e="1px";if(f>1024){f=f/1024;e="2px";if(f>1024){f=f/1024;e="3px";if(f>1024){f=f/1024;e="4px"}}}return e});linktip.data(linetextdata).text(function(e){});linktip.append("svg:title").text(function(p){var q=p.flow;var r=" Kbps";if(q>1024){q=q/1024;r=" Mbps";if(q>1024){q=q/1024;r=" Gbps";if(q>1024){q=q/1024;r=" Tbps"}}}var g=p.outflow;var e=" Kbps";if(g>1024){g=g/1024;e=" Mbps";if(g>1024){g=g/1024;e=" Gbps";if(g>1024){g=g/1024;e=" Tbps"}}}var f=p.inflow;var o=" Kbps";if(f>1024){f=f/1024;o=" Mbps";if(f>1024){f=f/1024;o=" Gbps";if(f>1024){f=f/1024;o=" Tbps"}}}var l;var k;if(p.sdesc==""||p.sdesc==undefined){l=p.source.localip+":"+p.sinterface}else{l=p.source.localip+":"+p.sinterface+"["+p.sdesc+"]"}if(p.tdesc==""||p.tdesc==undefined){k=p.target.localip+":"+p.tinterface}else{k=p.target.localip+":"+p.tinterface+"["+p.tdesc+"]"}var n="% (100Mbps)";if(p.speed>100){n="% (1000Mbps)"}if(p.speed>1000){n="% (10Gbps)"}var m=linktips.replace("p1",l).replace("p2",k).replace("p3",Math.round(q*10)/10+r).replace("p4",Math.round(p.pkts*10)/10+" Pkts/s").replace("p5",Math.round(p.broadcast*10)/10+" Pkts/s").replace("p6",Math.round(p.bwusage*10)/10+n).replace("p7",Math.round(p.avgframeLen*10)/10+" Byte/Pkt").replace("p8",Math.round(g*10)/10+e).replace("p9",Math.round(f*10)/10+o);if(p.alias!=""){m=p.alias+"\n"+m}return m});linktext.data(linetextdata).style("fill",function(e){return"#000000"}).style("visibility",function(e){if(a==1){return"hidden"}else{if(c.indexOf(e.lid)>=0){return"hidden"}}}).text(function(k){if(c.indexOf(k.lid)>=0){return""}else{switch(a){case 2:if(k.pkts==0){return""}else{return Math.round(k.pkts*10)/10+"Pkts/s"}case 3:if(k.broadcast==0){return""}else{return Math.round(k.broadcast*10)/10+"Pkts/s"}case 4:if(k.bwusage==0){return""}else{var f="% (100Mbps)";if(k.speed>100){f="% (1000Mbps)"}if(k.speed>1000){f="% (10Gbps)"}return Math.round(k.bwusage*10)/10+f}case 5:var g=k.outflow;var e=" Kbps";if(g>1024){g=g/1024;e=" Mbps";if(g>1024){g=g/1024;e=" Gbps";if(g>1024){g=g/1024;e=" Tbps"}}}if(g==0){return""}else{return Math.round(g*10)/10+e}case 6:var g=k.inflow;var e=" Kbps";if(g>1024){g=g/1024;e=" Mbps";if(g>1024){g=g/1024;e=" Gbps";if(g>1024){g=g/1024;e=" Tbps"}}}if(g==0){return""}else{return Math.round(g*10)/10+e}default:return""}}});linkintext.data(linetextdata).style("fill",function(e){return"#000000"}).style("visibility",function(e){if(a==1){if(c.indexOf(e.lid)>=0){return"hidden"}}else{return"hidden"}}).text(function(g){if(c.indexOf(g.lid)>=0){return""}else{var f=g.inflow;var e=" Kbps";if(f>1024){f=f/1024;e=" Mbps";if(f>1024){f=f/1024;e=" Gbps";if(f>1024){f=f/1024;e=" Tbps"}}}if(f==0){return""}else{return Math.round(f*10)/10+e}}});linkouttext.data(linetextdata).style("fill",function(e){return"#000000"}).style("visibility",function(e){if(a==1){if(c.indexOf(e.lid)>=0){return"hidden"}}else{return"hidden"}}).text(function(g){if(c.indexOf(g.lid)>=0){return""}else{var f=g.outflow;var e=" Kbps";if(f>1024){f=f/1024;e=" Mbps";if(f>1024){f=f/1024;e=" Gbps";if(f>1024){f=f/1024;e=" Tbps"}}}if(f==0){return""}else{return Math.round(f*10)/10+e}}});var b=this.getShowpc();if(b!=1){d3.selectAll("[class1=pc]").style("visibility","hidden")}this.DealLinks()},_initMainMenu:function(){var f=this;var g=d3.select("#Mainmenu").append("ul");var k=this.getMenudesc();var n=k.split(":");for(var e=0;e<n.length;e++){var a=n[e].split("$");if(a.length>1){var l=g.append("li");l.append("a").style("cursor","pointer").text(a[0]);var d=l.append("ul").attr("id","main"+e+"");for(var c=1;c<a.length;c++){d.append("li").append("a").style("cursor","pointer").text(a[c])}}else{var m=g.append("li").append("a").attr("id","main"+e+"").style("cursor","pointer").text(n[e])}}var o=f.getShowpc();var b=f.getPcmenu().split("$");if(o==1){g.append("li").append("a").attr("id","showpcpc").style("cursor","pointer").text(b[1])}else{g.append("li").append("a").attr("id","showpcpc").style("cursor","pointer").text(b[0])}g.select("#showpcpc").on("click",function(q,p){if(f.getShowpc()==1){d3.selectAll("[class1=pc]").style("visibility","hidden");g.select("#showpcpc").text(b[0]);f.setShowpc(0);f._savedata("showpc",0)}else{d3.selectAll("[class1=pc]").style("visibility","visible");f.setShowpc(1);g.select("#showpcpc").text(b[1]);f._savedata("showpc",1)}});g.select("#main0").selectAll("a").on("click",function(q,p){f.refreshNodeText(p)});g.select("#main1").selectAll("a").on("click",function(q,p){f.refreshLinkText(p)});g.select("#main2").selectAll("a").on("click",function(q,p){f.scalesize(p)});g.select("#main3").selectAll("a").on("click",function(q,p){f.topolayout(p)});g.select("#main4").on("click",function(q,p){f.savetopo()});g.select("#main5").on("click",function(r,p){var q=new Array();q.push(mousexx);q.push(mouseyy);f._savedata("adddevice",q)});g.select("#main6").on("click",function(q,p){f._savedata("locatenode","")});g.select("#main7").on("click",function(q,p){f._savedata("toposet","")});g.select("#main8").on("click",function(r,p){var q=d3.select("#overviewparent").style("display");if(q=="none"){d3.select("#overviewparent").style("display","inline-block")}else{d3.select("#overviewparent").style("display","none")}})},_initMenu:function(){var e=this;var f=d3.select("#mymenu").append("ul");var g=this.getNodemenudesc();var m=g.split(":");nodemenucount=m.length;for(var d=0;d<m.length;d++){var a=m[d].split("$");if(a.length>1){var k=f.append("li");k.append("a").style("cursor","pointer").text(a[0]);var c=k.append("ul").attr("id","node"+d+"");for(var b=1;b<a.length;b++){c.append("li").append("a").style("cursor","pointer").text(a[b])}}else{var l=f.append("li").append("a").attr("id","node"+d+"").style("cursor","pointer").text(m[d])}}f.select("#node0").on("click",function(o,n){e._savedata("devicepropery",selectnode)});f.select("#node1").on("click",function(o,n){e._savedata("deviceconnect",selectnode)});f.select("#node2").on("click",function(o,n){e._savedata("devicepanel",selectnode)});f.select("#node3").on("click",function(o,n){e._savedata("deviceport",selectnode)});f.select("#node4").on("click",function(o,n){e._savedata("devicecpumem",selectnode)});f.select("#node5").selectAll("a").on("click",function(o,n){if(n==0){e._savedata("deviceiftable",selectnode)}else{if(n==1){e._savedata("deviceroutetable",selectnode)}else{if(n==2){e._savedata("devicemactable",selectnode)}else{if(n==3){e._savedata("devicearptable",selectnode)}else{if(n==4){e._savedata("devicecdptable",selectnode)}else{if(n==5){e._savedata("deviceiptable",selectnode)}}}}}}});f.select("#node6").selectAll("a").on("click",function(o,n){if(n==0){e._savedata("devicealertfast",selectnode)}else{if(n==1){e._savedata("devicealertcategory",selectnode)}}});f.select("#node7").on("click",function(q,n){var o=nodelinedata[selectnode].localip;var p=nodelinedata[selectnode].otype;if(p==0||p==1||p==2||p==3){window.open("http://"+o);e._savedata("deviceweb",selectnode)}});f.select("#node8").selectAll("a").on("click",function(o,n){if(n==0){e._savedata("devicetelnet",selectnode)}else{if(n==1){e._savedata("deviceping",selectnode)}else{if(n==2){e._savedata("devicetracetoute",selectnode)}else{if(n==3){e._savedata("devicesnmptest",selectnode)}}}}});f.select("#node9").on("click",function(o,n){e._savedata("devicerefresh",selectnode)});f.select("#node10").on("click",function(p,n){var o=new Array();o.push(selectnode);e._savedata("delgroup",o)})},_initSubMenu:function(){var e=this;var a=d3.select("#submenu").append("ul");var d=this.getSubmenudesc();var c=d.split(":");for(var b=0;b<c.length;b++){var f=a.append("li").append("a").style("cursor","pointer").text(c[b])}a.selectAll("a").on("click",function(m,g){var k=new Array();selectnodes=new Array();for(j=0;j<nodedata.length;j++){var l=nodedata[j];if(l.selected){k.push(l.sid);selectnodes.push(l.sid)}}if(g==0){k.push(mousexx);k.push(mouseyy);e._savedata("createsubtopo",k)}if(g==1){e._savedata("delgroup",k)}})},_initGroupMenu:function(){var e=this;var a=d3.select("#groupmenu").append("ul");var d=this.getGroupmenudesc();var c=d.split(":");for(var b=0;b<c.length;b++){var f=a.append("li").append("a").style("cursor","pointer").text(c[b])}a.selectAll("a").on("click",function(k,g){if(g==0){e._savedata("looksubchart",selectgroup)}if(g==1){e._savedata("cancelsubchart",selectgroup)}})},_initLinkMenu:function(){var f=this;var b=d3.select("#linkmenu").append("ul");var e=this.getLinkmenudesc();var d=e.split(":");for(var c=0;c<d.length;c++){var g=b.append("li").append("a").style("cursor","pointer").text(d[c])}var a=f.getLineshowhide().split("$");b.append("li").append("a").attr("id","linehideshow").style("cursor","pointer").text(a[1]);b.selectAll("a").on("click",function(n,m){if(m==0){f._savedata("linepropery",selectlink)}if(m==1){f._savedata("lineflow",selectlink)}if(m==2){f._savedata("delline",selectlink)}if(m==3){f._savedata("linkset",selectlink)}if(m==4){var l=d3.select("#linehideshow").text();var k=f.getLinkDisplayType();if(k==1){if(l==a[1]){d3.select("#text2linkin"+selectlink).style("visibility","hidden");d3.select("#text2linkout"+selectlink).style("visibility","hidden");d3.select("#link"+selectlink).style("marker-mid","").style("marker-end","").style("marker-start","");d3.select("#link1"+selectlink).style("marker-mid","").style("marker-end","").style("marker-start","");f._hidelines.push(selectlink)}else{for(m=0;m<f._hidelines.length;m++){if(f._hidelines[m]===selectlink){f._hidelines.splice(m,1);break}}}}else{if(l==a[1]){d3.select("#text2link"+selectlink).style("visibility","hidden");d3.select("#text2linkin"+selectlink).style("visibility","visible");d3.select("#text2linkout"+selectlink).style("visibility","visible");d3.select("#link"+selectlink).style("marker-mid","").style("marker-end","").style("marker-start","");d3.select("#link1"+selectlink).style("marker-mid","").style("marker-end","").style("marker-start","");f._hidelines.push(selectlink)}else{d3.select("#text2link"+selectlink).style("visibility","visible");for(m=0;m<f._hidelines.length;m++){if(f._hidelines[m]===selectlink){f._hidelines.splice(m,1);break}}}}f._savedata("linkhideshow",selectlink)}})},savetopo:function(){var b=this.getShowpc();if(b==1){this._savedata("savetopo",nodedata)}else{var a=nodedata.filter(function(c){return(c.otype!=5)});this._savedata("savetopo",a)}},topolayout:function(a){var b=this;switch(a){case 0:b._selectItem("circular");break;case 1:b._selectItem("normal");break;case 2:b._selectItem("orthogonal");break;default:b._selectItem("circular")}},scalesize:function(b){switch(b){case 1:currentscale=currentscale-0.1;if(currentscale<0.1){currentscale=0.1}d3.select(".layer").attr("transform","scale("+currentscale+")");if(currentscale>=0.1){dragrect.data([{x:0,y:0,w:74*currentscale,h:72*currentscale}]);dragrect.attr("width",function(l){return l.w}).attr("height",function(l){return l.h})}break;case 2:d3.select(".layer").attr("transform","scale(1)");dragrect.data([{x:0,y:0,w:74,h:72}]);dragrect.attr("width",function(l){return l.w}).attr("height",function(l){return l.h});break;case 3:var k=0;var g=0;for(j=0;j<nodedata.length;j++){var f=nodedata[j];if(f.nx>k){k=f.nx}if(f.ny>g){g=f.ny}}var a=that1.getCompWidth();var e=that1.getCompHeight();var d=Math.max(a/k,e/g);var c=Math.min(a/k,e/g);if(d>1){currentscale=c}else{currentscale=d}d3.select(".layer").attr("transform","scale("+currentscale+")");if(currentscale>=1){dragrect.data([{x:0,y:0,w:74*currentscale,h:72*currentscale}]);dragrect.attr("width",function(l){return l.w}).attr("height",function(l){return l.h})}break;default:currentscale=currentscale+0.1;if(currentscale>8){currentscale=8}d3.select(".layer").attr("transform","scale("+currentscale+")");if(currentscale>=1){dragrect.data([{x:0,y:0,w:74*currentscale,h:72*currentscale}]);dragrect.attr("width",function(l){return l.w}).attr("height",function(l){return l.h})}}},refreshNodeText:function(a){var b=this;switch(a){case 1:b._savedata("name","");nodetext.text(function(c){return c.name});break;case 2:b._savedata("model","");nodetext.text(function(c){return c.model});break;case 3:b._savedata("customname","");nodetext.text(function(c){return c.customname});break;default:b._savedata("ip","");nodetext.text(function(c){return c.localip})}},refreshLinkText:function(a){var b=this;var c=this.getHidelines();if(a==0){d3.select(".text2link").selectAll("text").style("visibility","hidden");d3.select(".text2linkin").selectAll("text").style("visibility","visible");d3.select(".text2linkout").selectAll("text").style("visibility","visible")}else{d3.select(".text2link").selectAll("text").style("visibility","visible");d3.select(".text2linkin").selectAll("text").style("visibility","hidden");d3.select(".text2linkout").selectAll("text").style("visibility","hidden")}switch(a){case 1:this.setLinkDisplayType(5);b._savedata("outflow","");link.data(linetextdata).attr("d",function(l){var k=(l.source.nx+l.target.nx)/2;var g=(l.source.ny+l.target.ny)/2;var f=(l.source.nx+k)/2;var e=(l.source.ny+g)/2;return"M"+l.source.nx+","+l.source.ny+" "+f+","+e+" "+k+","+g}).style("marker-mid","").style("marker-end",function(e){if(c.indexOf(e.lid)>=0){return""}else{return"url(#end-arrow)"}}).style("Stroke",function(f){var e=b.getlinkcolor(f);return e});link1.data(linetextdata).attr("d",function(l){var g=(l.source.nx+l.target.nx)/2;var e=(l.source.ny+l.target.ny)/2;var k=(g+l.target.nx)/2;var f=(e+l.target.ny)/2;return"M"+g+","+e+" "+k+","+f+" "+l.target.nx+","+l.target.ny}).style("marker-mid","").style("Stroke",function(f){var e=b.getlinkcolor(f);return e});linktext.data(linetextdata).style("fill",function(e){}).text(function(g){var f=g.outflow;var e=" Kbps";if(f>1024){f=f/1024;e=" Mbps";if(f>1024){f=f/1024;e=" Gbps";if(f>1024){f=f/1024;e=" Tbps"}}}if(f==0){return""}else{return Math.round(f*10)/10+e}});break;case 2:this.setLinkDisplayType(6);b._savedata("inflow","");link.data(linetextdata).attr("d",function(l){var k=(l.source.nx+l.target.nx)/2;var g=(l.source.ny+l.target.ny)/2;var f=(l.source.nx+k)/2;var e=(l.source.ny+g)/2;return"M"+k+","+g+" "+f+","+e+" "+l.source.nx+","+l.source.ny}).style("marker-mid","").style("marker-start",function(e){if(c.indexOf(e.lid)>=0){return""}else{return"url(#end-arrow)"}}).style("Stroke",function(f){var e=b.getlinkcolor(f);return e});link1.data(linetextdata).attr("d",function(l){var g=(l.source.nx+l.target.nx)/2;var e=(l.source.ny+l.target.ny)/2;var k=(g+l.target.nx)/2;var f=(e+l.target.ny)/2;return"M"+l.target.nx+","+l.target.ny+" "+k+","+f+" "+g+","+e}).style("marker-mid","").style("Stroke",function(f){var e=b.getlinkcolor(f);return e});linktext.data(linetextdata).style("fill",function(e){}).text(function(g){var f=g.inflow;var e=" Kbps";if(f>1024){f=f/1024;e=" Mbps";if(f>1024){f=f/1024;e=" Gbps";if(f>1024){f=f/1024;e=" Tbps"}}}if(f==0){return""}else{return Math.round(f*10)/10+e}});break;case 3:b._savedata("pkts","");this.setLinkDisplayType(2);link.data(linetextdata).style("marker-end","").style("marker-start","").style("marker-mid","").style("Stroke",function(f){var e=b.getlinkcolor(f);return e});link1.data(linetextdata).style("marker-end","").style("marker-start","").style("marker-mid","").style("Stroke",function(f){var e=b.getlinkcolor(f);return e});linktext.data(linetextdata).style("fill",function(e){}).text(function(e){if(e.pkts==0){return""}else{return Math.round(e.pkts*10)/10+"Pkts/s"}});break;case 4:this.setLinkDisplayType(3);b._savedata("broadcast","");link.data(linetextdata).style("marker-end","").style("marker-start","").style("marker-mid","").style("Stroke",function(f){var e=b.getlinkcolor(f);return e});link1.data(linetextdata).style("marker-end","").style("marker-start","").style("marker-mid","").style("Stroke",function(f){var e=b.getlinkcolor(f);return e});linktext.data(linetextdata).style("fill",function(e){}).text(function(e){if(e.broadcast==0){return""}else{return Math.round(e.broadcast*10)/10+" Pkts/s"}});break;case 5:this.setLinkDisplayType(4);b._savedata("bwusage","");link.data(linetextdata).style("marker-mid","").style("Stroke",function(f){var e=b.getlinkcolor(f);return e});link1.data(linetextdata).style("marker-end","").style("marker-start","").style("marker-mid","").style("Stroke",function(f){var e=b.getlinkcolor(f);return e});linktext.data(linetextdata).style("fill",function(e){}).text(function(e){if(e.bwusage==0){return""}else{return Math.round(e.bwusage*10)/10+"%  (100Mbps)"}});break;default:this.setLinkDisplayType(1);b._savedata("flow","");link.data(linetextdata).attr("d",function(l){var k=(l.source.nx+l.target.nx)/2;var g=(l.source.ny+l.target.ny)/2;var f=(l.source.nx+k)/2;var e=(l.source.ny+g)/2;return"M"+k+","+g+" "+f+","+e+" "+l.source.nx+","+l.source.ny}).style("marker-end","").style("marker-start","").style("marker-mid",function(e){if(c.indexOf(e.lid)>=0){return""}else{return"url(#end-arrow)"}}).style("Stroke",function(f){var e=b.getlinkcolor(f);return e});link1.data(linetextdata).attr("d",function(l){var g=(l.source.nx+l.target.nx)/2;var e=(l.source.ny+l.target.ny)/2;var k=(g+l.target.nx)/2;var f=(e+l.target.ny)/2;return"M"+g+","+e+" "+k+","+f+" "+l.target.nx+","+l.target.ny}).style("marker-end","").style("marker-start","").style("marker-mid",function(e){if(c.indexOf(e.lid)>=0){return""}else{return"url(#end-arrow)"}}).style("Stroke",function(f){var e=b.getlinkcolor(f);return e});linktext.data(linetextdata).style("fill",function(e){}).text(function(n){var l=n.flow;var e=" Kbps";if(l>1024){l=l/1024;e=" Mbps";if(l>1024){l=l/1024;e=" Gbps";if(l>1024){l=l/1024;e=" Tbps"}}}var k=n.outflow;var g=" Kbps";if(k>1024){k=k/1024;g=" Mbps";if(k>1024){k=k/1024;g=" Gbps";if(k>1024){k=k/1024;g=" Tbps"}}}var f=n.inflow;var m=" Kbps";if(f>1024){f=f/1024;m=" Mbps";if(f>1024){f=f/1024;m=" Gbps";if(f>1024){f=f/1024;m=" Tbps"}}}if(l==0){return""}else{return" in:"+Math.round(f*10)/10+m+" out:"+Math.round(k*10)/10+g}})}},contextmainmenu:function(){var d=d3.select("#mymenu").style("display");var c=d3.select("#linkmenu").style("display");var b=d3.select("#submenu").style("display");var n=d3.select("#groupmenu").style("display");var k=that1.getTopy();var m=that1.getLeftx();if(d==="none"&&c==="none"&&b==="none"&&n==="none"){var e=maindiv.scrollLeft;var l=maindiv.scrollTop;var f=d3.mouse(this);var a=f[0];var g=f[1];mousexx=a+e;mouseyy=g+l;d3.select("#Mainmenu").style("position","absolute").style("left",a+"px").style("top",g+"px").style("display","inline-block").on("mouseleave",function(){d3.select("#Mainmenu").style("display","none")});d3.event.preventDefault()}},contextlinkmenu:function(e,f){selectlink=e.lid;var b=d3.select("#link"+selectlink);if(b!=null&&b!=undefined&&b!=""){var l=b.style("visibility");if(l=="hidden"){return}}var d=that1.getLineshowhide().split("$");var o=that1.getLinkDisplayType();if(o==1){var k=d3.select("#text2linkin"+selectlink).style("visibility");if(k=="visible"){d3.select("#linehideshow").text(d[1])}else{d3.select("#linehideshow").text(d[0])}}else{var k=d3.select("#text2link"+selectlink).style("visibility");if(k=="visible"){d3.select("#linehideshow").text(d[1])}else{d3.select("#linehideshow").text(d[0])}}var c=maindiv.scrollLeft;var n=maindiv.scrollTop;var g=d3.mouse(this);var a=g[0];var m=g[1];mousexx=a-c;mouseyy=m-n;d3.select("#linkmenu").style("position","absolute").style("left",mousexx+"px").style("top",mouseyy+"px").style("display","inline-block").on("mouseleave",function(){d3.select("#linkmenu").style("display","none")});d3.event.preventDefault()},getAngle:function(b,d,a,c){x=a-b;y=c-d;hypotenuse=Math.sqrt(Math.pow(x,2)+Math.pow(y,2));cos=x/hypotenuse;radian=Math.acos(cos);angle=180*radian/Math.PI;if(y<0){angle=-angle}else{if((y==0)&&(x<0)){angle=180}}if(angle>=90){angle=angle+180}if(angle<=-90){angle=angle-180}return angle},inioverviewnode:function(){var b=d3.select("#overview");var c=b.append("g").attr("class","ovnodelist");ovnode=c.selectAll(".ovnode");ovnode=ovnode.data(nodedata);var a=this.getShowpc();ovnode.enter().append("g").attr("class1",function(e){if(e.otype==5){return"pc"}else{return"nopc"}}).style("visibility",function(e){if(e.otype==5){if(a==1){return"visible"}else{return"hidden"}}else{return"visible"}}).attr("class","ovnode").attr("transform",function(e){return"translate("+e.nx+", "+e.ny+")"});ovnode.append("svg:image").attr("x",-16).attr("y",-16).attr("width",32).attr("height",32).attr("xlink:href",function(e){switch(e.otype){case 0:return"rwt-resources/topomap/SwitchRouter_Blue.ico";case 1:return"rwt-resources/topomap/Switch_Blue.ico";case 2:return"rwt-resources/topomap/Router_Blue.ico";case 3:return"rwt-resources/topomap/Firewall_Blue.ico";case 4:return"rwt-resources/topomap/Server_Blue.ico";case 5:return"rwt-resources/topomap/PC_Blue.ico";case 7:return"rwt-resources/topomap/HUB_Blue.ico";case 8:return"rwt-resources/topomap/noSnmp.png";case 9:return"rwt-resources/topomap/database.png";case 23:return vvimage="rwt-resources/topomap/APwifi.bmp";case 100:return"rwt-resources/topomap/Grouping_Blue.ico";default:return"rwt-resources/topomap/Other_Blue.ico"}});scaleFactor=1;defaultscaleFactor=0.1;currentscale=1;w=this.getMaxX();h=this.getMaxY();scaleFactor=Math.min(overvieww/w,overviewh/h);b.attr("transform","scale("+scaleFactor+")")},updateoverviewnode:function(){ovnode=ovnode.data(nodedata);ovnode.attr("transform",function(b){return"translate("+b.nx+", "+b.ny+")"});var a=ovnode.enter().append("g").attr("class","ovnode").attr("transform",function(b){return"translate("+b.nx+", "+b.ny+")"});a.append("svg:image").attr("x",-16).attr("y",-16).attr("width",32).attr("height",32).attr("xlink:href",function(b){switch(b.otype){case 0:return"rwt-resources/topomap/SwitchRouter_Blue.ico";case 1:return"rwt-resources/topomap/Switch_Blue.ico";case 2:return"rwt-resources/topomap/Router_Blue.ico";case 3:return"rwt-resources/topomap/Firewall_Blue.ico";case 4:return"rwt-resources/topomap/Server_Blue.ico";case 5:return"rwt-resources/topomap/PC_Blue.ico";case 7:return"rwt-resources/topomap/HUB_Blue.ico";case 8:return"rwt-resources/topomap/noSnmp.png";case 9:return"rwt-resources/topomap/database.png";case 23:return vvimage="rwt-resources/topomap/APwifi.bmp";case 100:return"rwt-resources/topomap/Grouping_Blue.ico";default:return"rwt-resources/topomap/Other_Blue.ico"}});ovnode.exit().remove()},inioverviewlink:function(){var c=this;var a=c.getShowpc();var b=d3.select("#overview");ovlink=b.append("g").attr("class","ovlink").selectAll("line");ovlink=ovlink.data(linetextdata);ovlink.enter().append("line").attr("class1",function(e){if(e.source.otype==5||e.target.otype==5){return"pc"}else{return"nopc"}}).attr("x1",function(e){return e.source.nx}).attr("y1",function(e){return e.source.ny}).attr("x2",function(e){return e.target.nx}).attr("y2",function(e){return e.target.ny}).style("visibility",function(e){if(e.source.otype==5||e.target.otype==5){if(a==1){return"visible"}else{return"hidden"}}else{return"visible"}}).style("stroke-width","2").style("Stroke",function(f){var e=c.getlinkcolor(f);return e})},updateoverviewlink:function(){var b=this;var a=Math.ceil(defaultscaleFactor/scaleFactor)*2;ovlink=ovlink.data(linetextdata);ovlink.attr("x1",function(c){return c.source.nx}).attr("y1",function(c){return c.source.ny}).attr("x2",function(c){return c.target.nx}).attr("y2",function(c){return c.target.ny}).style("stroke-width",a+"").style("Stroke",function(e){var c=b.getlinkcolor(e);return c});ovlink.enter().append("line").attr("x1",function(c){return c.source.nx}).attr("y1",function(c){return c.source.ny}).attr("x2",function(c){return c.target.nx}).attr("y2",function(c){return c.target.ny}).style("stroke-width","2").style("Stroke",function(e){var c=b.getlinkcolor(e);return c});ovlink.exit().remove()},initrect:function(){this.setOverView();var k=this.getMaxX();var g=this.getMaxY();var f=this.getCompWidth();var e=this.getCompHeight();var d=d3.behavior.drag().origin(Object).on("drag",c);var b=d3.select("#overviewsvg");ovbrush=b.append("g").attr("class","brush").data([{x:0,y:0,w:74,h:72}]);dragrect=ovbrush.append("rect").attr("class","extent").attr("x",function(l){return l.x}).attr("y",function(l){return l.y}).attr("width",function(l){return l.w}).attr("height",function(l){return l.h}).attr("cursor","move").attr("stroke","#fff").call(d);function c(l){dragrect.attr("x",l.x=Math.max(0,Math.min(overvieww-l.w,d3.event.x))).attr("y",l.y=Math.max(0,Math.min(overviewh-l.h,d3.event.y)));a(l)}function a(n){var l=overvieww-n.w;var m=overviewh-n.h;maindiv.scrollLeft=(maindiv.scrollWidth-f)/l*n.x;maindiv.scrollTop=(maindiv.scrollHeight-e)/m*n.y}},setOverView:function(){var e=this.getCompWidth();var b=this.getCompHeight();maindiv.style.width=e+"px";maindiv.style.height=b+"px";var c=e-overvieww-20;var f=b-overviewh-20;overviewparentdiv=document.getElementById("overviewparent");overviewparentdiv.style.width=overvieww+"px";overviewparentdiv.style.height=overviewh+"px";overviewparentdiv.style.left=c+"px";overviewparentdiv.style.top=f+"px";var a=d3.behavior.drag().on("drag",d);d3.select("#overviewparent").style("cursor","move").call(a);function d(l){var g=maindiv.style.width.indexOf("px");var k=maindiv.style.height.indexOf("px");var p=maindiv.style.width.substring(0,g);var n=maindiv.style.height.substring(0,k);var q=parseInt(p)-overvieww-20;var m=parseInt(n)-overviewh-20;var r=Math.max(20,Math.min(d3.event.x-100,q));var o=Math.max(20,Math.min(d3.event.y-100,m));overviewparentdiv.style.left=r+"px";overviewparentdiv.style.top=o+"px"}},_removeElements:function(a){a.transition().duration(400).attr("opacity",0).remove()},_savedata:function(a,c){d3.select("#linkmenu").style("display","none");d3.select("#Mainmenu").style("display","none");d3.select("#mymenu").style("display","none");var b=rap.getRemoteObject(this);b.notify("Selection",{index:a,data:c})},_selectItem:function(a){d3.select("#linkmenu").style("display","none");d3.select("#Mainmenu").style("display","none");d3.select("#mymenu").style("display","none");var b=rap.getRemoteObject(this);b.notify("Selection",{index:a,data:""})}};rap.registerTypeHandler("topomap.TopoMap",{factory:function(a){var b=rap.getObject(a.parent);return new topomap.TopoMap(b)},destructor:"destroy",properties:["nodetooltipdesc","grouptooltipdesc","linktooltipdesc","alertdata","refreshdata","layoutdata","linkmenudesc","menudesc","groupmenudesc","nodemenudesc","tooltipdata","maxX","maxY","compWidth","compHeight","overviewWidth","submenudesc","overviewHeight","nodeDisplayType","linkDisplayType","topy","leftx","cleardata","render","newlinedata","newgroup","newdevice","subchartdata","plinedata","pnodedata","showpc","pcmenu","locatenode","toposet","linkset","delnode","deline","lineshowhide","hidelines"],events:["Selection"]});